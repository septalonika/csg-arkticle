<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to ArkTicle</title>
    <style>
      /* Apply Inter font globally */
      body {
        font-family: "Inter", sans-serif;
      }
      /* Ensure table layout is fixed for consistent column widths */
      .table-fixed-layout {
        table-layout: fixed;
      }
      /* Allow content in cells to wrap and expand height */
      .table-cell-content {
        word-wrap: break-word; /* For older browsers */
        overflow-wrap: break-word; /* Standard property */
      }
    </style>
    <link rel="stylesheet" href="./public/css/style.css" />
  </head>
  <body class="p-8 bg-gray-100">
    <div class="container mx-auto">
      <h1 class="mb-6 text-3xl font-bold text-center text-gray-800">
        Ark<span class="text-blue-500">Ticle</span>
      </h1>

      <!-- Search Input -->
      <div class="flex items-center mb-4 space-x-2">
        <label for="search" class="sr-only">Search</label>
        <div class="relative flex items-center w-full max-w-md mx-auto">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="absolute w-5 h-5 text-gray-400 left-3"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
          <input
            class="w-full py-2 pl-10 pr-4 transition duration-200 ease-in-out bg-white border border-gray-300 rounded-lg focus:border-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none"
            type="search"
            name="search"
            id="search"
            placeholder="Search by title or body..."
            aria-label="Search"
          />
        </div>
      </div>

      <!-- Container where the table will be rendered -->
      <div
        id="table-container"
        class="mb-4 overflow-x-auto rounded-lg shadow-md"
      >
        <!-- The JavaScript will inject the table here -->
        <p class="py-8 text-center text-gray-600">Loading data...</p>
      </div>

      <!-- Pagination Controls -->
      <div
        id="pagination-controls"
        class="flex items-center justify-center mt-4 space-x-2"
      >
        <!-- Pagination buttons will be injected here by JavaScript -->
      </div>
    </div>

    <script>
      // Global variables for pagination state
      let currentPage = 1;
      const itemsPerPage = 5; // Display 5 items per page
      let allTableData = []; // To store all original data
      let filteredTableData = []; // To store data after applying search filter

      /**
       * Dynamically creates and renders an HTML table from an array of data.
       *
       * @param {Array<Object>} data - An array of objects, where each object represents a row.
       * The keys of the objects will be used as table headers.
       * @param {string} containerId - The ID of the HTML element where the table should be appended.
       */
      function createTable(data, containerId) {
        const container = document.getElementById(containerId);
        if (!container) {
          console.error(`Container with ID "${containerId}" not found.`);
          return;
        }

        // Clear existing content in the container
        container.innerHTML = "";

        // If no data, display a message
        if (!data || data.length === 0) {
          container.innerHTML =
            '<p class="py-8 text-center text-gray-600">No data available to display.</p>';
          return;
        }

        // Create table element
        const table = document.createElement("table");
        // Apply Tailwind classes for styling the table and custom class for fixed layout
        table.className =
          "min-w-full border border-collapse border-gray-300 rounded-lg overflow-hidden table-fixed-layout";

        // Create table header (thead)
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        headerRow.className = "bg-gray-100"; // Header row background

        // Get headers from the keys of the first data object, excluding 'id'
        const headers = Object.keys(data[0]).filter((key) => key !== "id");

        // Define column widths for better control with table-layout: fixed
        // Adjusted widths since 'id' column is removed
        const columnWidths = {
          userId: "w-2/12",
          title: "w-4/12",
          body: "w-6/12",
        };

        headers.forEach((headerText) => {
          const th = document.createElement("th");
          // Apply width classes and other styling
          th.className = `px-4 py-3 text-sm font-semibold text-center text-gray-700 border border-gray-300 uppercase tracking-wider ${columnWidths[headerText] || ""}`;

          // Customize header text for 'userId', 'title', 'body'
          let displayHeaderText = headerText;
          if (headerText === "userId") {
            displayHeaderText = "User ID";
          } else if (headerText === "title") {
            displayHeaderText = "Title";
          } else if (headerText === "body") {
            displayHeaderText = "Body";
          } else {
            // Convert camelCase to readable text (e.g., userId -> User Id) for other headers
            displayHeaderText = headerText.replace(/([A-Z])/g, " $1").trim();
          }
          th.textContent = displayHeaderText;
          headerRow.appendChild(th); // Append th to headerRow
        });
        thead.appendChild(headerRow); // Append headerRow to thead
        table.appendChild(thead); // Append thead to table

        // Create table body (tbody)
        const tbody = document.createElement("tbody");

        // Populate table rows
        data.forEach((rowData, index) => {
          const tr = document.createElement("tr");
          tr.className = `border-b border-gray-200 ${rowData.body.toLowerCase().includes("rerum") ? "bg-sky-200" : index % 2 === 0 ? "bg-white" : "bg-gray-100"} hover:bg-blue-300 transition duration-150 ease-in-out`;

          // Iterate over filtered headers to create cells
          headers.forEach((key) => {
            const td = document.createElement("td");
            td.className = `px-4 py-2 text-sm text-gray-800 border-r border-gray-200 last:border-r-0 table-cell-content`;
            td.textContent = rowData[key];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.appendChild(table);
      }

      function renderTableAndPagination() {
        const dataToRender =
          filteredTableData.length > 0 ||
          document.getElementById("search").value !== ""
            ? filteredTableData
            : allTableData;

        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const paginatedData = dataToRender.slice(startIndex, endIndex);

        createTable(paginatedData, "table-container");
        updatePaginationControls(dataToRender.length); // Pass the total count of data being rendered
      }
      function createPaginationButton(text, isActive, isDisabled, onClick) {
        const button = document.createElement("button");
        button.textContent = text;
        button.className = `px-4 py-2 rounded-md transition duration-150 ${
          isActive
            ? "bg-blue-600 text-white"
            : "bg-gray-200 text-gray-800 hover:bg-gray-300"
        } ${isDisabled ? "bg-gray-300 text-gray-600 cursor-not-allowed" : ""}`;
        button.disabled = isDisabled;
        if (onClick) {
          button.addEventListener("click", onClick);
        }
        return button;
      }

      function updatePaginationControls(totalDataCount) {
        const paginationContainer = document.getElementById(
          "pagination-controls",
        );
        if (!paginationContainer) {
          console.error("Pagination controls container not found.");
          return;
        }
        paginationContainer.innerHTML = ""; // Clear existing controls

        const totalPages = Math.ceil(totalDataCount / itemsPerPage);
        if (totalPages <= 1) {
          // No pagination needed if only one page or less
          return;
        }

        // Previous button
        paginationContainer.appendChild(
          createPaginationButton("<", false, currentPage === 1, () => {
            if (currentPage > 1) {
              currentPage--;
              renderTableAndPagination();
            }
          }),
        );

        const pagesToDisplay = new Set();
        const maxButtons = 5; // Total number of buttons to show including 1, ..., totalPages
        const numAdjacent = Math.floor((maxButtons - 3) / 2); // Number of buttons around current page (e.g., 2 for 7 buttons)

        // Always add the first page
        pagesToDisplay.add(1);

        // Add pages around the current page
        for (
          let i = currentPage - numAdjacent;
          i <= currentPage + numAdjacent;
          i++
        ) {
          if (i > 0 && i <= totalPages) {
            pagesToDisplay.add(i);
          }
        }

        // Always add the last page
        pagesToDisplay.add(totalPages);

        // Convert set to array, sort
        const sortedPages = Array.from(pagesToDisplay).sort((a, b) => a - b);

        // Render buttons and ellipses
        let lastPageRendered = 0;
        sortedPages.forEach((page) => {
          if (page - lastPageRendered > 1) {
            const ellipsisSpan = document.createElement("span");
            ellipsisSpan.textContent = "...";
            ellipsisSpan.className = "px-2 py-2 text-gray-600";
            paginationContainer.appendChild(ellipsisSpan);
          }
          paginationContainer.appendChild(
            createPaginationButton(page, currentPage === page, false, () => {
              currentPage = page;
              renderTableAndPagination();
            }),
          );
          lastPageRendered = page;
        });

        // Next button
        paginationContainer.appendChild(
          createPaginationButton(">", false, currentPage === totalPages, () => {
            if (currentPage < totalPages) {
              currentPage++;
              renderTableAndPagination();
            }
          }),
        );
      }

      /**
       * Filters the table data based on the search input.
       */
      function filterTableData() {
        const searchTerm = document
          .getElementById("search")
          .value.toLowerCase();
        if (searchTerm === "") {
          filteredTableData = allTableData; // If search term is empty, show all data
        } else {
          filteredTableData = allTableData.filter(
            (item) =>
              item.title.toLowerCase().includes(searchTerm) ||
              item.body.toLowerCase().includes(searchTerm),
          );
        }
        currentPage = 1; // Reset to first page on new search
        renderTableAndPagination();
      }

      // --- Data Fetching and Initial Render ---
      document.addEventListener("DOMContentLoaded", async () => {
        const tableContainer = document.getElementById("table-container");
        const searchInput = document.getElementById("search");

        try {
          // Display loading message
          tableContainer.innerHTML =
            '<p class="py-8 text-center text-gray-600">Loading data from API...</p>';

          const response = await fetch(
            "https://jsonplaceholder.typicode.com/posts",
          );
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          allTableData = await response.json();
          filteredTableData = allTableData; // Initially, filtered data is all data

          renderTableAndPagination(); // Render table with fetched data

          // Add event listener for search input
          searchInput.addEventListener("input", filterTableData);
        } catch (error) {
          console.error("Error fetching data:", error);
          tableContainer.innerHTML = `<p class="py-8 text-center text-red-600">Failed to load data: ${error.message}. Please try again later.</p>`;
          const paginationControls = document.getElementById(
            "pagination-controls",
          );
          if (paginationControls) {
            paginationControls.innerHTML = ""; // Clear pagination controls on error
          }
        }
      });
    </script>
  </body>
</html>
